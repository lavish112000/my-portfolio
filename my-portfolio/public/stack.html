<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Tech Stack Tower</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            overflow: hidden; /* Prevent scrollbars */
            background-color: #030712; /* Fallback background */
        }
        #game-canvas {
            position: fixed;
            top: 0;
            left: 0;
            outline: none;
        }
        .ui-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none; /* Allow clicks to pass through to the canvas */
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .ui-content {
            pointer-events: auto; /* Re-enable pointer events for UI elements */
        }
        /* Custom modal styles */
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 50;
        }
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 0.5rem;
            text-align: center;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            color: #1f2937; /* Gray-800 */
        }
    </style>
</head>
<body>

    <canvas id="game-canvas"></canvas>

    <!-- UI Overlay -->
    <div class="ui-overlay p-4 sm:p-6 md:p-8">
        <!-- Top Section: Header and Info Box -->
        <div class="flex justify-between items-start">
            <header class="text-left mb-4 ui-content max-w-lg">
                <h1 class="text-4xl sm:text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-pink-500 via-purple-500 to-blue-400">3D Tech Stack Tower</h1>
                 <p class="text-gray-300 mt-2 text-lg">Click a block, then click the correct platform. Drag to rotate.</p>
            </header>

            <div id="info-box" class="w-full max-w-sm bg-gray-900/70 backdrop-blur-sm p-4 rounded-lg shadow-lg ui-content border border-purple-500/30">
                <h3 id="info-title" class="font-semibold text-lg mb-2 text-gray-200">Technology Info</h3>
                <p id="info-text" class="text-gray-300 text-sm">Click on a technology block to see its description.</p>
            </div>
        </div>
    </div>

    <!-- Win Modal -->
    <div id="win-modal" class="modal-backdrop hidden ui-content">
        <div class="modal-content">
            <h2 class="text-3xl font-bold text-green-500 mb-4">Tower Complete!</h2>
            <p class="text-lg mb-6">You've successfully built the 3D Tech Stack Tower!</p>
            <button id="restart-button" class="bg-purple-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-purple-700 transition-colors">Play Again</button>
        </div>
    </div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
                "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
            }
        }
    </script>
    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { TextGeometry } from 'three/addons/geometries/TextGeometry.js';
        import { FontLoader } from 'three/addons/loaders/FontLoader.js';
        import { RoundedBoxGeometry } from 'three/addons/geometries/RoundedBoxGeometry.js';
        import { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';
        import { RenderPass } from 'three/addons/postprocessing/RenderPass.js';
        import { UnrealBloomPass } from 'three/addons/postprocessing/UnrealBloomPass.js';

        // --- DATA ---
        const technologies = [
            { id: 'java', name: 'Java', category: 'backend', desc: 'A robust, object-oriented language used for building large-scale enterprise applications and Android apps.' },
            { id: 'python', name: 'Python', category: 'backend', desc: 'A versatile language popular for web development, data science, AI, and automation.' },
            { id: 'javascript', name: 'JavaScript', category: 'frontend', desc: 'The core language of the web, making websites interactive and dynamic. Can also be used on the backend with Node.js.' },
            { id: 'html', name: 'HTML', category: 'frontend', desc: 'The standard markup language for creating web pages and web applications. It forms the skeleton of a site.' },
            { id: 'threejs', name: 'Three.js', category: 'frontend', desc: 'A JavaScript library used to create and display animated 3D computer graphics in a web browser.' },
            { id: 'nextjs', name: 'Next.js', category: 'frontend', desc: 'A popular React framework for building fast, server-rendered web applications with a great developer experience.' },
            { id: 'flutter', name: 'Flutter', category: 'frontend', desc: 'A UI toolkit by Google for building beautiful, natively compiled applications for mobile, web, and desktop from a single codebase.' },
            { id: 'tailwind', name: 'Tailwind CSS', category: 'frontend', desc: 'A utility-first CSS framework for rapidly building custom user interfaces without leaving your HTML.' },
            { id: 'react', name: 'React', category: 'frontend', desc: 'A JavaScript library for building user interfaces, particularly for single-page applications where UI changes frequently.' },
            { id: 'apache', name: 'Apache', category: 'backend', desc: 'One of the most widely used web server software platforms, responsible for serving web content.' },
            { id: 'restapi', name: 'REST API', category: 'backend', desc: 'An architectural style for designing networked applications, allowing different systems to communicate over HTTP.' },
            { id: 'dsa', name: 'DSA', category: 'backend', desc: 'Data Structures & Algorithms are the foundation of efficient problem-solving and software development.' },
            { id: 'expressjs', name: 'Express.js', category: 'backend', desc: 'A minimal and flexible Node.js web application framework that provides a robust set of features for web and mobile applications.' },
            { id: 'nodejs', name: 'Node.js', category: 'backend', desc: 'A JavaScript runtime built on Chrome\'s V8 engine that allows developers to run JavaScript on the server-side.' },
            { id: 'oracle', name: 'Oracle', category: 'database', desc: 'A powerful, multi-model relational database management system for running online transaction processing and data warehousing.' },
            { id: 'mongodb', name: 'MongoDB', category: 'database', desc: 'A popular NoSQL database that stores data in flexible, JSON-like documents, making it easy to scale and develop with.' },
            { id: 'gcp', name: 'GCP', category: 'devops', desc: 'Google Cloud Platform offers a suite of cloud computing services for hosting, computing, storage, and more.' },
            { id: 'aws', name: 'AWS', category: 'devops', desc: 'Amazon Web Services is a comprehensive and broadly adopted cloud platform, offering over 200 fully featured services.' },
            { id: 'azure', name: 'Azure', category: 'devops', desc: 'Microsoft\'s cloud computing service for building, testing, deploying, and managing applications and services.' },
            { id: 'github', name: 'GitHub', category: 'tools', desc: 'A platform for version control and collaboration, allowing developers to host and review code, manage projects, and build software.' },
            { id: 'docker', name: 'Docker', category: 'devops', desc: 'A platform that uses OS-level virtualization to deliver software in packages called containers, ensuring consistency across environments.' },
            { id: 'kubernetes', name: 'Kubernetes', category: 'devops', desc: 'An open-source container orchestration system for automating software deployment, scaling, and management.' },
            { id: 'vscode', name: 'VS Code', category: 'tools', desc: 'A lightweight but powerful source code editor from Microsoft that runs on your desktop and is available for Windows, macOS and Linux.' }
        ];

        const categories = {
            frontend: { color: 0x3b82f6, gradient: ['#60a5fa', '#c084fc'], name: 'Frontend', y: 0 },
            backend: { color: 0xa855f7, gradient: ['#c084fc', '#f472b6'], name: 'Backend', y: 3 },
            database: { color: 0xec4899, gradient: ['#f472b6', '#f87171'], name: 'Database', y: 6 },
            devops: { color: 0xf43f5e, gradient: ['#f87171', '#fb923c'], name: 'DevOps & Cloud', y: 9 },
            tools: { color: 0xf97316, gradient: ['#fb923c', '#facc15'], name: 'Tools', y: 12 },
        };

        // --- SCENE SETUP ---
        let scene, camera, renderer, controls, composer;
        let raycaster, mouse;
        let techBlocks = [], platforms = [], placedBlocks = [], animatedIcons = [];
        let starField;
        let selectedBlock = null;
        let placedCount = 0;
        const clock = new THREE.Clock();
        
        const infoTitle = document.getElementById('info-title');
        const infoText = document.getElementById('info-text');
        const winModal = document.getElementById('win-modal');
        const restartButton = document.getElementById('restart-button');

        function init() {
            // Main scene
            scene = new THREE.Scene();
            scene.fog = new THREE.Fog(0x030712, 50, 100);
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(15, 10, 25);

            const canvas = document.getElementById('game-canvas');
            renderer = new THREE.WebGLRenderer({ canvas: canvas, antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.toneMapping = THREE.ACESFilmicToneMapping;
            renderer.toneMappingExposure = 0.9;

            controls = new OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.target.set(0, 6, 0);

            const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
            scene.add(ambientLight);
            const directionalLight = new THREE.DirectionalLight(0xffffff, 1.5);
            directionalLight.position.set(10, 20, 5);
            scene.add(directionalLight);

            const renderScene = new RenderPass(scene, camera);
            const bloomPass = new UnrealBloomPass(new THREE.Vector2(window.innerWidth, window.innerHeight), 0.4, 0.5, 0.1);
            composer = new EffectComposer(renderer);
            composer.addPass(renderScene);
            composer.addPass(bloomPass);

            raycaster = new THREE.Raycaster();
            mouse = new THREE.Vector2();
            
            createStarfield();

            const fontLoader = new FontLoader();
            fontLoader.load('https://cdn.jsdelivr.net/npm/three@0.160.0/examples/fonts/helvetiker_regular.typeface.json', (font) => {
                createGameAssets(font);
            });

            window.addEventListener('resize', onWindowResize);
            window.addEventListener('click', onClick);
            restartButton.addEventListener('click', resetGame);
        }

        function createGradientTexture(colors) {
            const canvas = document.createElement('canvas');
            canvas.width = 1;
            canvas.height = 256;
            const context = canvas.getContext('2d');
            const gradient = context.createLinearGradient(0, 0, 0, 256);
            gradient.addColorStop(0, colors[0]);
            gradient.addColorStop(1, colors[1]);
            context.fillStyle = gradient;
            context.fillRect(0, 0, 1, 256);
            return new THREE.CanvasTexture(canvas);
        }
        
        function createStarfield() {
            const vertices = [];
            for (let i = 0; i < 15000; i++) {
                const x = THREE.MathUtils.randFloatSpread(300);
                const y = THREE.MathUtils.randFloatSpread(300);
                const z = THREE.MathUtils.randFloatSpread(300);
                vertices.push(x, y, z);
            }
            const geometry = new THREE.BufferGeometry();
            geometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));
            const material = new THREE.PointsMaterial({ color: 0xaaaaaa, size: 0.15 });
            starField = new THREE.Points(geometry, material);
            scene.add(starField);
        }

        function createTechIcon(techId) {
            const group = new THREE.Group();
            const material = new THREE.MeshStandardMaterial({ color: 0xffffff, emissive: 0xffffff, emissiveIntensity: 0.5, roughness: 0.2 });
            group.userData.animation = 'rotate';

            switch (techId) {
                case 'react':
                case 'threejs':
                case 'nextjs': {
                    const nucleus = new THREE.Mesh(new THREE.SphereGeometry(0.1, 16, 16), material);
                    const ring1 = new THREE.Mesh(new THREE.TorusGeometry(0.5, 0.03, 16, 100), material);
                    const ring2 = new THREE.Mesh(new THREE.TorusGeometry(0.5, 0.03, 16, 100), material);
                    const ring3 = new THREE.Mesh(new THREE.TorusGeometry(0.5, 0.03, 16, 100), material);
                    ring2.rotation.x = Math.PI / 2;
                    ring3.rotation.y = Math.PI / 2;
                    group.add(nucleus, ring1, ring2, ring3);
                    break;
                }
                 case 'python': {
                    const curve = new THREE.CatmullRomCurve3([
                        new THREE.Vector3(-0.5, -0.3, 0),
                        new THREE.Vector3(-0.2, 0.3, 0),
                        new THREE.Vector3(0.2, -0.3, 0),
                        new THREE.Vector3(0.5, 0.3, 0)
                    ]);
                    const snakeGeo = new THREE.TubeGeometry(curve, 20, 0.05, 8, false);
                    const snake1 = new THREE.Mesh(snakeGeo, new THREE.MeshStandardMaterial({ color: 0x306998, emissive: 0x306998, emissiveIntensity: 0.5 }));
                    const snake2 = new THREE.Mesh(snakeGeo, new THREE.MeshStandardMaterial({ color: 0xffd43b, emissive: 0xffd43b, emissiveIntensity: 0.5 }));
                    snake2.position.y += 0.1;
                    snake2.rotation.z = Math.PI;
                    group.add(snake1, snake2);
                    break;
                }
                case 'docker': {
                    const body = new THREE.Mesh(new THREE.CapsuleGeometry(0.3, 0.8, 4, 8), material);
                    body.rotation.z = Math.PI / 2;
                    const tail = new THREE.Mesh(new THREE.BoxGeometry(0.5, 0.5, 0.1), material);
                    tail.position.x = 0.6;
                    for(let i=0; i<3; i++) {
                        const box = new THREE.Mesh(new THREE.BoxGeometry(0.2, 0.15, 0.2), material);
                        box.position.set(-0.3 + i * 0.25, 0.2, 0);
                        group.add(box);
                    }
                    group.add(body, tail);
                    group.userData.animation = 'bob';
                    break;
                }
                case 'mongodb':
                case 'oracle': {
                    for (let i = 0; i < 3; i++) {
                        const disk = new THREE.Mesh(new THREE.CylinderGeometry(0.5, 0.5, 0.1, 32), material);
                        disk.position.y = (i - 1) * 0.2;
                        group.add(disk);
                    }
                    group.userData.animation = 'bob';
                    break;
                }
                case 'aws':
                case 'gcp':
                case 'azure': {
                     for (let i = 0; i < 5; i++) {
                        const cloudPart = new THREE.Mesh(new THREE.SphereGeometry(0.3, 16, 16), material);
                        cloudPart.position.set((Math.random() - 0.5) * 0.7, (Math.random() - 0.5) * 0.3, (Math.random() - 0.5) * 0.2);
                        group.add(cloudPart);
                    }
                    group.userData.animation = 'bob';
                    break;
                }
                 case 'github': {
                    const head = new THREE.Mesh(new THREE.SphereGeometry(0.3, 32, 32), material);
                    const body = new THREE.Mesh(new THREE.CapsuleGeometry(0.3, 0.2, 4, 8), material);
                    body.position.y = -0.3;
                    const ear1 = new THREE.Mesh(new THREE.ConeGeometry(0.1, 0.2, 32), material);
                    ear1.position.set(-0.2, 0.3, 0);
                    const ear2 = new THREE.Mesh(new THREE.ConeGeometry(0.1, 0.2, 32), material);
                    ear2.position.set(0.2, 0.3, 0);
                    group.add(head, body, ear1, ear2);
                    break;
                }
                default: {
                    const box = new THREE.Mesh(new THREE.BoxGeometry(0.6, 0.6, 0.6), material);
                    group.add(box);
                    break;
                }
            }
            animatedIcons.push(group);
            return group;
        }

        function createGameAssets(font) {
            Object.values(categories).forEach(cat => {
                const platformGeo = new THREE.CylinderGeometry(8, 8.5, 0.5, 128);
                const gradientTexture = createGradientTexture(cat.gradient);
                const platformMat = new THREE.MeshStandardMaterial({ 
                    map: gradientTexture, 
                    emissiveMap: gradientTexture, 
                    emissive: 0xffffff, 
                    emissiveIntensity: 0.02,
                    roughness: 0.8
                });
                const platform = new THREE.Mesh(platformGeo, platformMat);
                platform.position.y = cat.y;
                platform.userData = { type: 'platform', category: Object.keys(categories).find(key => categories[key] === cat) };
                scene.add(platform);
                platforms.push(platform);

                const textGeo = new TextGeometry(cat.name, { font: font, size: 0.8, height: 0.1 });
                const textMat = new THREE.MeshStandardMaterial({ color: 0xffffff, emissive: 0xffffff, emissiveIntensity: 0.4 });
                const textMesh = new THREE.Mesh(textGeo, textMat);
                textMesh.geometry.center();
                textMesh.position.set(0, cat.y + 1.5, 0);
                scene.add(textMesh);
            });

            technologies.forEach((tech, i) => {
                const blockGeo = new RoundedBoxGeometry(1.5, 1.5, 1.5, 4, 0.1);
                const blockMat = new THREE.MeshStandardMaterial({ 
                    color: 0x38bdf8, 
                    metalness: 0.3, 
                    roughness: 0.4,
                    transparent: true,
                    opacity: 0.3
                });
                const block = new THREE.Mesh(blockGeo, blockMat);
                const angle = (i / technologies.length) * Math.PI * 2;
                const radius = 16;
                block.position.set(Math.cos(angle) * radius, 1, Math.sin(angle) * radius);
                block.userData = { ...tech, type: 'block', originalPos: block.position.clone(), originalColor: block.material.color.getHex() };
                
                const icon = createTechIcon(tech.id);
                block.add(icon);

                scene.add(block);
                techBlocks.push(block);
            });
        }
        
        function resetGame() {
            placedCount = 0;
            winModal.classList.add('hidden');
            infoTitle.textContent = 'Technology Info';
            infoText.textContent = 'Click on a technology block to see its description.';
            selectedBlock = null;

            placedBlocks.forEach(b => scene.remove(b));
            placedBlocks = [];

            techBlocks.forEach(block => {
                block.position.copy(block.userData.originalPos);
                block.material.color.setHex(block.userData.originalColor);
                block.material.emissive.setHex(0x000000);
                block.visible = true;
            });
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            composer.setSize(window.innerWidth, window.innerHeight);
        }

        function onClick(event) {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = - (event.clientY / window.innerHeight) * 2 + 1;

            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(scene.children, true);

            if (intersects.length > 0) {
                let clickedObject = intersects[0].object;
                while (clickedObject.parent && !clickedObject.userData.type) {
                    clickedObject = clickedObject.parent;
                }
                const userData = clickedObject.userData;

                if (userData.type === 'block' && clickedObject.visible) {
                    handleBlockClick(clickedObject);
                } else if (userData.type === 'platform' && selectedBlock) {
                    handlePlatformClick(clickedObject);
                }
            }
        }

        function handleBlockClick(block) {
            if (selectedBlock) {
                selectedBlock.material.emissive.setHex(0x000000);
            }
            selectedBlock = block;
            selectedBlock.material.emissive.setHex(0x00ff00);
            
            infoTitle.textContent = selectedBlock.userData.name;
            infoText.textContent = selectedBlock.userData.desc;
        }

        function handlePlatformClick(platform) {
            const platformCategory = platform.userData.category;
            const blockCategory = selectedBlock.userData.category;

            if (platformCategory === blockCategory) {
                selectedBlock.visible = false;
                const placedBlock = selectedBlock.clone();
                const platformY = platform.position.y;
                const placedOnThisPlatform = placedBlocks.filter(b => b.userData.category === platformCategory).length;
                const angle = (placedOnThisPlatform / 5) * Math.PI * 2;
                const radius = 5;
                placedBlock.position.set(Math.cos(angle) * radius, platformY + 1.25, Math.sin(angle) * radius);
                const skyBlueColor = new THREE.Color(0x0ea5e9);
                placedBlock.material.color.set(skyBlueColor);
                placedBlock.material.emissive.set(skyBlueColor);
                placedBlock.material.emissiveIntensity = 0.25;
                placedBlock.material.opacity = 0.5;
                placedBlock.visible = true;
                scene.add(placedBlock);
                placedBlocks.push(placedBlock);
                selectedBlock = null;
                placedCount++;
                infoTitle.textContent = 'Correct!';
                infoText.textContent = 'Select another technology block.';
                
                if (placedCount === technologies.length) {
                    winModal.classList.remove('hidden');
                }
            } else {
                infoText.textContent = 'Incorrect category. Try again!';
                const originalEmissive = platform.material.emissive.getHex();
                platform.material.emissive.setHex(0xff0000);
                setTimeout(() => {
                    platform.material.emissive.setHex(originalEmissive);
                }, 500);
            }
        }

        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            const delta = clock.getDelta();
            const elapsedTime = clock.getElapsedTime();
            
            animatedIcons.forEach(icon => {
                if (icon.userData.animation === 'rotate') {
                    icon.rotation.y += delta * 0.5;
                    icon.rotation.x += delta * 0.3;
                }
                if (icon.userData.animation === 'bob') {
                    icon.position.y = Math.sin(elapsedTime * 2 + icon.position.x) * 0.1;
                }
            });
            
            if (starField) {
                starField.rotation.y += 0.0002;
                starField.rotation.x += 0.0001;
            }

            composer.render(delta);
        }

        init();
        animate();
    </script>
</body>
</html>